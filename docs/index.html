<html>
  <head>
    <title>Trending</title>
    <link rel="stylesheet" href="bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  </head>
  <body>

    <div class="form-group">
    <label for="language">Choose a language</label>
    <select class="form-control" id="language" onchange="languageChanged(this)"></select>
  </div>

    <table class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Repository name</th>
    </tr>
  </thead>
  <tbody id="repoBody"></tbody>
</table>

    <script>
      let finalOBject;

      const checkForInitialLanguage = () => {
        const searchFragment = window.location.search;
        if(searchFragment) {
          console.log(searchFragment);
          const language = searchFragment.replace("?language=", "");
          console.log(language);
          updateList(language);
        }
      }
  

      fetch('./language.json')
      .then(res => res.json())
      .then(res => {
          const selectInput = document.getElementById('language');
          res.map(lang => {
            let option = document.createElement('option');
            option.value = lang;
            option.innerHTML = lang;
            selectInput.appendChild(option);
          });
      })
      .catch(err => console.log('err', err));


      fetch('./data.json')
      .then(res => res.json())
      .then(res => {
        finalOBject = res;
        checkForInitialLanguage();
      })
      .catch(err => console.log('err', err));

      const languageChanged = (select) => {
        updateList(select.value);
      }

      const updateList = (language) => {
        const repositoriesToDisplay = finalOBject[language];
        let idx = 0;
        const tbody = document.getElementById("repoBody")
        tbody.innerHTML = "";
        repositoriesToDisplay.map(repo => {
          let tr = document.createElement('tr');
          let th = document.createElement('th');
          th.scope = "row";
          th.innerHTML = ++idx;
          tr.appendChild(th);
          let td = document.createElement('td');
          td.innerHTML = repo;
          tr.appendChild(td);
          tbody.appendChild(tr);
        });
        const selectInput = document.getElementById('language');
        selectInput.value = language;
      }

    </script>
  </body>
</html>
